---
# generate time-focused json data suitable for TimelineJS.
# includes all items in metadata that have a "date" field filled.
# Curate the timeline by adding a "where" expression to the assign on the first line.
# For details, see https://collectionbuilder.github.io/cb-docs/docs/advanced/timelinejs/
---
{%- assign items = site.data[site.metadata] | where_exp: 'item', 'item.date' -%}
{
    "title": {
        "media": {
          "url": "{% include image/featured-image.html %}",
          "caption": {{ featuredItem.title | jsonify }},
          "credit": {{ site.title | jsonify }}
        },
        "text": {
          "headline": {{ site.title | append: ' Timeline' | jsonify }},
          "text": "The role of visual art and architecture within Catholic, Habsburg Spain and colonial Latin America during the early modern period is surveyed, with an emphasis on transculturation from the hybrid forms produced under Islamic mudejar influence to colonial mestizaje in the encounters of Christian visual culture with that of indigenous America."
        }
    },

    "events": [
      {% for item in items %}{% if item.date %}{
        "media": {
          "url": "{% if item.youtubeid %}{{ 'https://www.youtube.com/watch?v=' | append: item.youtubeid }}{% elsif item.vimeoid %}{{ 'https://vimeo.com/' | append: item.vimeoid }}{% elsif item.filename contains 'http' %}{{ item.filename }}{% else %}{{ item.filename | prepend: '/objects/' | absolute_url }}{% endif %}",
          "caption": {{ item.title | jsonify }},
          "link": "{{ '/item.html' | absolute_url | append: '?id=' | append: item.objectid }}",
          "credit": "{{ site.title }}"
        },
        "start_date": { {% if item.date contains '-' %}{% assign dates = item.date | split: '-' %}
          "month": "{{ dates[1] }}",
          "day": "{{ dates[2] }}",
          "year": "{{ dates[0] }}"{% elsif item.date contains '/' %}"year": "{{ item.date | strip | split: '/' | last }}"{% else %}
          "year": "{{ item.date }}"{% endif %}
        },
        "text": {
          "headline": {{ item.title | jsonify }}{% if item.description %},
          "text": {{ item.description | jsonify }}{% endif %}
        }
      }{% unless forloop.last %},{% endunless %}{% endif %}{% endfor %}
    ]
}
